#!groovy    

apply from: file('config/gradle/blueprint.gradle')
apply from: file('config/gradle/check.gradle')

sourceCompatibility = 1.7
targetCompatibility = 1.7

buildscript {
    ext {
        springBootVersion = '1.2.3.RELEASE'
    }
    repositories {
        maven  {
        	url "http://repo1.maven.org/maven2"
    	}
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}") 
    }
}

apply plugin: 'spring-boot'

springBoot {
    mainClass = 'com.nike.mm.MeasurementorApplication'
}

bootRun {
    addResources = false
}

jar {
    baseName = 'measurementor'
    version = '0.0.1-SNAPSHOT'
}

apply plugin: 'war'

war {
    baseName = 'measurementor'
    version =  '0.0.1-SNAPSHOT'
}

task wrapper(type: Wrapper) {
    gradleVersion = '2.4'
}

task installNpm(type: Exec) {
    description = 'Install NPM, the Node Package Manager'
    workingDir 'public'
    commandLine 'npm', 'install'
}

task installBower(type: Exec) {
    description = 'Install Bower, the Package Manager'
    workingDir 'public'
    commandLine 'bower', 'install'
}

task buildWebApp(type: Exec) {
    description = 'Builds the web application'
    workingDir 'public'
    commandLine 'grunt', 'build'
}

task copyWebAppcopyWebApp(type: Copy) {
    from 'public/dist'
    into 'build/resources/webapp'
}

tasks.war.dependsOn installNpm, installBower, copyWebApp
